webpackJsonp([5],{237:function(e,t){"use strict";function n(e,t,n,o,a){var r={method:e,mode:"cors",headers:{"Content-Type":"application/json"},body:"GET"==e?null:JSON.stringify(n)};"get"==e.toLowerCase()&&(t+=l._getSearchFromObject(n)),fetch(t,r).then(l.checkStates).then(l.parseJSON).then(function(e){o(e)}).catch(function(e){return console.log(e),401==e.state?(alert("登录过期,重新登录"),void(location.hash="login")):void(e.response&&e.response.json().then(function(e){console.log(e),e.message&&alert(e.message)}))})}function o(e,t,n,o){var a=new XMLHttpRequest;a.open("POST",e),a.onload=function(e){var t=JSON.parse(a.responseText);if(200==a.status)n(t);else{var o=t;o.message&&alert(o.message)}},a.send(t)}Object.defineProperty(t,"__esModule",{value:!0});var a="userToken",r="http://114.215.80.72:4545/",l={checkStates:function(e){if(e.ok)return e;var t=new Error(e.statusText);throw t.state=e.status,t.response=e,t},parseJSON:function(e){return e.json()},_getSearchFromObject:function(e,t){if(null==e)return"";var n="?";for(var o in e)n+=o+"="+encodeURIComponent(e[o])+"&";return n.slice(0,-1)}},i={storeToken:function(e){localStorage.setItem(a,e)},fetchToken:function(){return localStorage.getItem(a)},register:function(e,t,o){n("POST",r+"user/register",e,t,o)},login:function(e,t,o){n("POST",r+"user/login",e,t,o)},getUserInfo:function(e,t,o){n("GET",r+"user/getUserInfo",e,t,o)},uploadAvatar:function(e,t,n){o(r+"user/uploadAvatar",e,t,n)},fetchArticle:function(e,t,o){n("GET",r+"user/fetchArticle",e,t,o)}},c={pulish:function(e,t,o){n("POST",r+"article/pulish",e,t,o)},fetchList:function(e,t,o){n("GET",r+"article/fetchList",e,t,o)},fetchArticle:function(e,t,o){n("GET",r+"article/fetchArticle/"+e,null,t,o)},giveStar:function(e,t,o){n("POST",r+"article/giveStar",e,t,o)},comment:function(e,t,o){n("POST",r+"article/comment",e,t,o)}};t.UserModel=i,t.ArticleModel=c},242:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(1),s=o(c),u=n(237),f=(n(172),n(34)),m=(o(f),function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={info:[]},n}return l(t,e),i(t,[{key:"componentDidMount",value:function(){var e=u.UserModel.fetchToken();return e?void this.fetchData():void this.context.router.push("login")}},{key:"fetchData",value:function(){var e=this,t=u.UserModel.fetchToken(),n={token:t};u.UserModel.getUserInfo(n,function(t){e.setState({info:t})},function(e){console.log(e)})}},{key:"componentWillUnmount",value:function(){}},{key:"openUpload",value:function(e){e.stopPropagation(),avatar.click()}},{key:"uploadAvatar",value:function(e){var t=this,n=e.target.files[0];if(console.log(n),n.size>204800)return void $.alert("头像大小不能超过200K");var o=this.refs.avatarForm,a=new FormData(o),r=u.UserModel.fetchToken();a.append("token",r),u.UserModel.uploadAvatar(a,function(e){$.toast(e.content),t.componentDidMount()},function(e){console.log(e)})}},{key:"signOut",value:function(e){var t=this;e.preventDefault(),setTimeout(function(){$.closePanel()},0),$.confirm("您要退出登录么?",function(){localStorage.removeItem("userToken"),t.context.router.push("/login")})}},{key:"toMyArticle",value:function(){var e=this;$.closePanel(),setTimeout(function(){e.context.router.push("/myArticle")},1e3)}},{key:"render",value:function(){var e=this;return s.default.createElement("div",null,s.default.createElement("header",{className:"bar bar-nav",style:{position:"relative"}},s.default.createElement("h1",{className:"title"},"我")),s.default.createElement("div",{className:"content",style:{top:"1.2rem"}},s.default.createElement("div",{className:"list-block"},s.default.createElement("ul",null,s.default.createElement("li",{className:"item-content item-link"},s.default.createElement("div",{className:"item-inner"},s.default.createElement("form",{id:"avatarForm",ref:"avatarForm",style:{display:"none"}},s.default.createElement("input",{type:"file",id:"avatar",ref:"avatar",name:"avatar",style:{display:"none"},onChange:this.uploadAvatar.bind(this)})),s.default.createElement("div",{className:"item-title"},s.default.createElement("img",{src:this.state.info.avatar,style:{height:"2.5rem"},onClick:function(t){e.openUpload(t)}})),s.default.createElement("div",{className:"item-after"},this.state.info.username))))),s.default.createElement("div",{className:"list-block"},s.default.createElement("ul",null,s.default.createElement("li",{className:"item-content"},s.default.createElement("div",{className:"item-media"},s.default.createElement("i",{className:"icon icon-edit"})),s.default.createElement("div",{className:"item-inner"},s.default.createElement("div",{onClick:function(){e.toMyArticle()},style:{height:"100%",width:"100%",display:"block"},className:"item-title"},"我的文章"))))),s.default.createElement("div",{className:"content-block"},s.default.createElement("p",null,s.default.createElement("a",{onClick:function(t){e.signOut(t)},className:"button button-danger button-fill button-big"},"退出登录")))))}}]),t}(s.default.Component));m.contextTypes={router:s.default.PropTypes.object},e.exports=m}});